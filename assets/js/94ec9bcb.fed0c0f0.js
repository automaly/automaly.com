"use strict";(self.webpackChunknuxulutest=self.webpackChunknuxulutest||[]).push([[3958],{32905:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=t(74848),o=t(28453);const s={title:"Number sequence farmework overview in Dynamics AX 2012",date:new Date("2017-01-19T00:00:00.000Z"),categories:["AX2012"],tags:["X++","numbersequence"]},a=void 0,i={id:"operation/tools/2017-01-19-number-sequence-farmework-in-Dynamics-AX-2012/index",title:"Number sequence farmework overview in Dynamics AX 2012",description:"number-sequence-overview",source:"@site/docs/05-operation/01-tools/2017-01-19-number-sequence-farmework-in-Dynamics-AX-2012/index.md",sourceDirName:"05-operation/01-tools/2017-01-19-number-sequence-farmework-in-Dynamics-AX-2012",slug:"/operation/tools/2017-01-19-number-sequence-farmework-in-Dynamics-AX-2012/",permalink:"/docs/operation/tools/2017-01-19-number-sequence-farmework-in-Dynamics-AX-2012/",draft:!1,unlisted:!1,tags:[{inline:!0,label:"X++",permalink:"/docs/tags/x"},{inline:!0,label:"numbersequence",permalink:"/docs/tags/numbersequence"}],version:"current",lastUpdatedBy:"Luan Nguyen",lastUpdatedAt:1701636614e3,frontMatter:{title:"Number sequence farmework overview in Dynamics AX 2012",date:"2017-01-19T00:00:00.000Z",categories:["AX2012"],tags:["X++","numbersequence"]},sidebar:"tutorialSidebar",previous:{title:"Web Services on IIS - Exception has been thrown by the target of an invocation",permalink:"/docs/operation/tools/2015-08-04-web-services-on-iis-exception-has-been-thrown-by-the-target-of-an-invocation-ax-installation/"},next:{title:"Dynamics 365 for finance and operations database synchronization using command line",permalink:"/docs/operation/tools/2019-08-05-database-sync-d365fo/"}},c={},l=[{value:"1. ETD",id:"1-etd",level:2},{value:"2. Table",id:"2-table",level:2},{value:"3. Enum",id:"3-enum",level:2},{value:"4. NumberSeqModule Class",id:"4-numberseqmodule-class",level:2},{value:"5. Parameters Table and Form",id:"5-parameters-table-and-form",level:2},{value:"5.1. Create <code>ContosoParameters</code> Table",id:"51-create-contosoparameters-table",level:3},{value:"5.2. Create <code>ContosoParameters</code> form",id:"52-create-contosoparameters-form",level:3},{value:"6. How to use on Table",id:"6-how-to-use-on-table",level:2},{value:"7. How to use on Form",id:"7-how-to-use-on-form",level:2},{value:"8. Optional method",id:"8-optional-method",level:2},{value:"9. Testing",id:"9-testing",level:2}];function d(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"number-sequence-overview",src:t(45421).A+"",title:"number-sequence-overview",width:"799",height:"587"})}),"\n",(0,r.jsxs)(n.p,{children:["For this demo, I will create New module along with NumberSequence, about creating Number Sequence ",(0,r.jsx)(n.em,{children:"without"})," module you also use same steps just leave some steps base on Design picture above."]}),"\n",(0,r.jsx)(n.h2,{id:"1-etd",children:"1. ETD"}),"\n",(0,r.jsxs)(n.p,{children:["Create ETD ",(0,r.jsx)(n.code,{children:"ContosoId"})," extends ",(0,r.jsx)(n.code,{children:"num"})," datatype."]}),"\n",(0,r.jsx)(n.h2,{id:"2-table",children:"2. Table"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"Contoso"})," Table with ",(0,r.jsx)(n.code,{children:"ContosoId"})," field."]}),"\n",(0,r.jsx)(n.h2,{id:"3-enum",children:"3. Enum"}),"\n",(0,r.jsxs)(n.p,{children:["Create a new enum value ",(0,r.jsx)(n.code,{children:"Contoso"})," in BaseEnum ",(0,r.jsx)(n.code,{children:"NumberSeqModule"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This value will be used to link number sequence to the module and to restrict displayed number sequence by module in Form."}),"\n",(0,r.jsx)(n.h2,{id:"4-numberseqmodule-class",children:"4. NumberSeqModule Class"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"NumberSeqModuleXXX"})," class"]}),"\n",(0,r.jsxs)(n.p,{children:["Create a new ",(0,r.jsx)(n.code,{children:"NumberSeqModuleXXX"})," class, such as ",(0,r.jsx)(n.code,{children:"NumberSeqModuleContoso"}),", which extends the ",(0,r.jsx)(n.code,{children:"NumberSeqApplicationModule"})," class. The sample code for creating this class is as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:'public class NumberSeqModuleContoso extends NumberSeqApplicationModule\n{\n}\n\nprotected void loadModule()\n{\n\tNumberSeqDatatype datatype = NumberSeqDatatype::construct();\n\t;\n\n\t/* Contoso Id */\n\tdatatype.parmDatatypeId(extendedtypenum(ContosoId));\n\tdatatype.parmReferenceHelp("ContosoId");\n\tdatatype.parmWizardIsContinuous(true);\n\tdatatype.parmWizardIsManual(NoYes::No);\n\tdatatype.parmWizardIsChangeDownAllowed(NoYes::No);\n\tdatatype.parmWizardIsChangeUpAllowed(NoYes::No);\n\tdatatype.parmWizardHighest(999999);\n\tdatatype.addParameterType(NumberSeqParameterType::DataArea, true, false);\n\tthis.create(datatype);\n}\n\npublic NumberSeqModule numberSeqModule()\n{\n\t;\n\treturn NumberSeqModule::Contoso;\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Use of the ",(0,r.jsx)(n.code,{children:"DataArea"})," segment in ",(0,r.jsx)(n.em,{children:"Step 4"})," to describe the default segment for the extended data types used for ",(0,r.jsx)(n.code,{children:"ContosoId"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Note In ",(0,r.jsx)(n.strong,{children:"Microsoft Dynamics AX 2009"}),", number sequence references could be initialized by restarting the Application Object Server (AOS). In ",(0,r.jsx)(n.strong,{children:"Microsoft Dynamics AX 2012"}),", the initialization of references to populate the ",(0,r.jsx)(n.code,{children:"NumberSequenceDatatype"})," and ",(0,r.jsx)(n.code,{children:"NumberSequenceParameterType"})," tables has moved to the initialization checklist. To initialize the newly created references, run a job that executes the ",(0,r.jsx)(n.code,{children:"LoadModule"})," method likes below."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"static void loadNumSeq (Args _args)\n{\n\t//define the class variable\n\tNumberSeqModuleContoso seqMod = new NumberSeqModuleContoso ();\n\t//load the number sequences that were not generated\n\tseqMod.load();\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also reinitialize all references by running a job that executes the ",(0,r.jsx)(n.code,{children:"LoadAll"})," method in the ",(0,r.jsx)(n.code,{children:"NumberSequenceModuleSetup"})," class. However, for reinitializing all references, you must ensure that there are no existing number sequences already defined in the system."]}),"\n",(0,r.jsxs)(n.p,{children:["Then run the wizard in ",(0,r.jsx)(n.em,{children:"Organization Administration > CommonForms > Numbersequences > Numbersequences > Generate > run the wizard"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"5-parameters-table-and-form",children:"5. Parameters Table and Form"}),"\n",(0,r.jsx)(n.p,{children:"Create a Number sequences page in the parameters form of the new module."}),"\n",(0,r.jsxs)(n.p,{children:["You need to Create ",(0,r.jsx)(n.code,{children:"ContosoParameters"})," Table along with form, See existing forms such as ",(0,r.jsx)(n.code,{children:"CustParameters"})," or ",(0,r.jsx)(n.code,{children:"LedgerParameters"})," for examples of the implementation."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["These forms are using ",(0,r.jsx)(n.strong,{children:"DetailsFormMaster"})," form parten as Best Practice for Setup form."]})}),"\n",(0,r.jsxs)(n.h3,{id:"51-create-contosoparameters-table",children:["5.1. Create ",(0,r.jsx)(n.code,{children:"ContosoParameters"})," Table"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add field key, Extends from ",(0,r.jsx)(n.code,{children:"ParametersKey"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Properties on Field key Visible = false, AllowEdit = false, AllowEditOnCreate = false"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create index name Key with AllowDuplicate = No."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Set table properties."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TableContent = Default data"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"ConfigurationKey"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"CacheLookup = Found"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TableGroup = Parameter"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"PrimaryKey = Key"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"ClusterKey = Key"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The sample code for creating method this table as below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:'void delete()\n{\n\tthrow error("@SYS23721");\n}\npublic void initValue()\n{\n\t;\n\tsuper();\n\t// Key is set to mandatory so set it to 1\n\tthis.Key = 1;\n}\nstatic ContosoParameters find(boolean _forupdate = false)\n{\n\tContosoParameters parameter;\n\n\tif (_forupdate)\n\t{\n\t\tparameter.selectForUpdate(_forupdate);\n\t}\n\n\tselect firstonly RecId from parameter\n\t\twhere parameter.Key == 1;\n\n\tif (!parameter && !parameter.isTmp())\n\t{\n\t\tCompany::createParameter(parameter);\n\t}\n\n\treturn parameter;\n}\nclient server static NumberSeqModule numberSeqModule()\n{\n\t;\n\treturn NumberSeqModule::Contoso;\n}\npublic server static NumberSequenceReference numRefContosoId()\n{\n\t;\n\tNumberSeqScopeFactory::CreateDataAreaScope(curext());\n\treturn NumberSeqReference::findReference(extendedtypenum (ContosoId));\n\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"52-create-contosoparameters-form",children:["5.2. Create ",(0,r.jsx)(n.code,{children:"ContosoParameters"})," form"]}),"\n",(0,r.jsxs)(n.p,{children:["Note This form can only be used for references that have a scope of DataArea. The administration forms described in the Setup and Administration of number sequences section can be used for references that have any scope. These forms can be found in ",(0,r.jsx)(n.em,{children:"Organization Administration > Common > Number Sequences"})]}),"\n",(0,r.jsxs)(n.p,{children:["The data source of Parameters form likes picture below, you can also refer to ",(0,r.jsx)(n.code,{children:"CustParameters"})," form for design."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"ContosoParameters",src:t(5787).A+"",title:"ContosoParameters",width:"291",height:"325"})}),"\n",(0,r.jsx)(n.p,{children:"Code example for form methods:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public class FormRun extends ObjectRun\n{\n\tNumberSeqReference          numberSeqReference;\n\tboolean                     runExecuteDirect;\n\tTmpIdRef                    tmpIdRef;\n\tNumberSeqScope              scope;\n\tNumberSeqApplicationModule  numberSeqApplicationModule;\n\tcontainer                   numberSequenceModules;\n}\n\nvoid init()\n{\n\t;\n\tthis.numberSeqPreInit();\n\tsuper();\n\tContosoParameters::find();\n\tthis.numberSeqPostInit();\n}\n\nvoid numberSeqPostInit()\n{\n\tnumberSequenceReference_ds.object(fieldNum(NumberSequenceReference, AllowSameAs)).visible(numberSeqApplicationModule.sameAsActive());\n\treferenceSameAsLabel.visible(numberSeqApplicationModule.sameAsActive());\n}\n\nvoid numberSeqPreInit()\n{\n\t;\n\trunExecuteDirect            = false;\n\n\tnumberSequenceModules       = [NumberSeqModule::Contoso];\n\tnumberSeqApplicationModule  = new NumberSeqModuleContoso ();\n\tscope                       = NumberSeqScopeFactory::createDataAreaScope();\n\tNumberSeqApplicationModule::createReferencesMulti(numberSequenceModules, scope);\n\n\ttmpIdRef.setTmpData(NumberSequenceReference::configurationKeyTableMulti(numberSequenceModules));\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Code example for ",(0,r.jsx)(n.code,{children:"NumberSequenceReference"})," data source methods"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"void removeFilter()\n{\n\t;\n\trunExecuteDirect = false;\n\tnumbersequenceReference_ds.executeQuery();\n}\n\nvoid executeQuery()\n{\n\tif (runExecuteDirect)\n\t{\n\t\tsuper();\n\t}\n\telse\n\t{\n\t\trunExecuteDirect = true;\n\t\tthis.queryRun(NumberSeqReference::buildQueryRunMulti(numberSequenceReference,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t tmpIdRef,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t numberSequenceTable,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t numberSequenceModules,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t scope));\n\t\tnumbersequenceReference_ds.research();\n\t}\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"6-how-to-use-on-table",children:"6. How to use on Table"}),"\n",(0,r.jsx)(n.p,{children:"Set number sequence in Contoso Table"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"private void setContosoId()\n{\n\tNumberSeq num;\n\tNumberSequenceReference numberSequenceReference;\n\t;\n\tnumberSequenceReference = CVRParameters::numRefContosoId();\n\n\tif (numberSequenceReference)\n\t{\n\t\tnum = NumberSeq::newGetNum(numberSequenceReference);\n\t\tthis.Id = num.num();\n\t}\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Optional method \u2013 in case you don\u2019t want to expose Number sequence on Form Level"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public void initValue()\n{\n\t;\n\tsuper();\n\n\t// Initialise the title id\n\tthis. setContosoId ();\n}\n\npublic void insert()\n{\n\t;\n\tif(!this.Id)\n\t{\n\t\tthis. setContosoId ();\n\t}\n\n\tsuper();\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"From now on you can create new record in Contoso Table with number sequence."}),"\n",(0,r.jsx)(n.h2,{id:"7-how-to-use-on-form",children:"7. How to use on Form"}),"\n",(0,r.jsx)(n.p,{children:"How to use on form level (In case you don\u2019t want to expose NS in Table Level)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"In the class declaration of the form that will be accessing data, add a variable declaration for the number sequence handler. The following example shows the variable definition for a number sequence handler."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public class FormRun extends ObjectRun\n{\n\tNumberSeqFormHandler numberSeqFormHandlerContosoId;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add the ",(0,r.jsx)(n.code,{children:"NumberSeqFormHandler"})," method to the form. The code in this method will create an instance of the number sequence form handler and return it."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public NumberSeqFormHandler numSeqFormHandlerContosoId()\n{\n\tif (!numberSeqFormHandlerContosoId)\n\t{\n\t\tnumberSeqFormHandlerContosoId = NumberSeqFormHandler::newForm(ContosoParameters:: numRefContosoId().NumberSequenceId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t element,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t Contoso_ds,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t fieldNum(Contoso, ContosoId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t}\n\treturn numberSeqFormHandlerContosoId;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.strong,{children:"create, delete, and write"})," methods to the data source of the table that contains the field for which the number sequence is being used. The following code examples show these methods that are added to the data source for the Contoso table to support the number sequence for the ",(0,r.jsx)(n.code,{children:"ContosoId"})," field."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public void create(boolean _append = false)\n{\n\t//before create, (ensure the number seuence has not run out of numbers)\n\telement.numSeqFormHandlerContosoId().formMethodDataSourceCreatePre();\n\n\t// start: inherited table code\n\t// we need to let the create happen so the user can\n\t// choose the type\n\tsuper(_append);\n\n\t//number sequence, create action, (get next number)\n\telement.numSeqFormHandlerContosoId().formMethodDataSourceCreate();\n}\npublic void delete()\n{\n\t//release the number sequence value.\n\telement. numSeqFormHandlerContosoId().formMethodDataSourceDelete();\n\n\t//delete the record\n\tsuper();\n}\npublic void write()\n{\n\tsuper();\n\telement. numSeqFormHandlerContosoId().formMethodDataSourceWrite();\n}\n\npublic boolean validateWrite()\n{\n\tboolean         ret;\n\tret = super();\n\tret = element.numberSeqFormHandler().formMethodDataSourceValidateWrite(ret) && ret;\n\tif (ret)\n\t{\n\t\tContoso.validateWrite();\n\t}\n\treturn ret;\n}\nLink Active()\npublic void linkActive()\n{\n\t;\n\telement.numberSeqFormHandler().formMethodDataSourceLinkActive();\n\tsuper();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"8-optional-method",children:"8. Optional method"}),"\n",(0,r.jsx)(n.p,{children:"Continuous sequence"}),"\n",(0,r.jsx)(n.p,{children:"To avoid having gaps for continuous sequence you should add this code to the delete of the table."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"public void delete()\n{\n\tsuper();\n\tNumberSeq::releaseNumber(ContosoParameters::numRefContosoId().NumberSequenceId, this.ContosoId);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"9-testing",children:"9. Testing"}),"\n",(0,r.jsx)(n.p,{children:"Testing Number sequence by Job"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-C#",children:"static void Max_numberSeqRefCustAccount(Args _args)\n{\n\tNumberSequenceReference numberSeqRefCustAccount = CustParameters::numRefCustAccount();\n\tNumberSeq               numSeqCustAccount;\n\ttry\n\t{\n//Use the TTS level to decide whether sequence is consumed or not.\n\t\tttsBegin;\n\t\tif (numberSeqRefCustAccount)\n\t\t{\n\t\t\tnumSeqCustAccount = NumberSeq::newGetNum(numberSeqRefCustAccount);\n\t\t\tif (numSeqCustAccount)\n\t\t\t{\n\t\t\t\tinfo(numSeqCustAccount.num());\n\t\t\t}\n\t\t}\n\t\tttsCommit;\n\t}\n\tcatch (Exception::Error)\n\t{\n\t   info(\"Caught 'Exception::Error'.\");\n\t}\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Thank you for reading!"})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},5787:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/ContosoParameters-06ed8e9ec60d80b9624d9c923188df84.png"},45421:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/number-sequence-overview-505f00b4aaf5c2fdcc4b4902091195a5.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(96540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);