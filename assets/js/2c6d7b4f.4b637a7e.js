"use strict";(self.webpackChunknuxulutest=self.webpackChunknuxulutest||[]).push([[3349],{23895:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var s=t(74848),a=t(28453);const r={date:"2024-01-02",title:"Using Kusto functions in Power BI datasource",categories:["Power BI"],tags:["Kusto","Power BI"],authors:"kome"},i=void 0,o={permalink:"/2024/01/04/KustoVsPBI",source:"@site/blog/2024-01-04-KustoVsPBI/index.md",title:"Using Kusto functions in Power BI datasource",description:"References",date:"2024-01-02T00:00:00.000Z",tags:[{inline:!0,label:"Kusto",permalink:"/tags/kusto"},{inline:!0,label:"Power BI",permalink:"/tags/power-bi"}],readingTime:1.82,hasTruncateMarker:!0,authors:[{name:"Kome Hoang",title:"Maintainer of Automaly",url:"https://www.linkedin.com/in/khahgm7",imageURL:"https://github.com/khahgm7.png",key:"kome",page:null}],frontMatter:{date:"2024-01-02",title:"Using Kusto functions in Power BI datasource",categories:["Power BI"],tags:["Kusto","Power BI"],authors:"kome"},unlisted:!1,lastUpdatedAt:1704706993e3,lastUpdatedBy:"Dynamics365",prevItem:{title:"Using XppPrePostArgs to pass parameters through a method",permalink:"/2024/01/02/TrickXppPrePostArg"},nextItem:{title:"No data is inserted/modified in temporary table when processing an SRS report using Pre-process",permalink:"/2024/01/04/NoDataInTmpTableForPreProcessReport"}},c={authorsImageUrls:[void 0]},l=[{value:"References",id:"references",level:2},{value:"How to",id:"how-to",level:2},{value:"Let&#39;s create demo data for testing",id:"lets-create-demo-data-for-testing",level:3},{value:"Get data from Azure Data Explorer (ADX) to Power BI (PBI)",id:"get-data-from-azure-data-explorer-adx-to-power-bi-pbi",level:3},{value:"Using Kusto function to simplify the process",id:"using-kusto-function-to-simplify-the-process",level:3},{value:"Enhacing data by altering the function",id:"enhacing-data-by-altering-the-function",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/data-explorer/power-bi-data-connector?tabs=web-ui",children:"Use Azure Data Explorer data in Power BI"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/data-explorer/kusto/management/create-function",children:".create function command"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://dataexplorer.azure.com/home",children:"Azure Data Explorer"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/",children:"Kusto Query Language (KQL)"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-to",children:"How to"}),"\n",(0,s.jsx)(n.h3,{id:"lets-create-demo-data-for-testing",children:"Let's create demo data for testing"}),"\n",(0,s.jsxs)(n.p,{children:["For the purpose of testing and demonstrating, I will create a new table in my testing ADX cluster (everyone can create their own free cluster following ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/data-explorer/start-for-free-web-ui",children:"Create a free Azure Data Explorer cluster"}),"). Let's call it ",(0,s.jsx)(n.code,{children:"UserAsset"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The table will have two fields:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"User"})," - type ",(0,s.jsx)(n.code,{children:"string"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"NumberOfLaptop"})," - type ",(0,s.jsx)(n.code,{children:"integer"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The script is as below."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:".create table UserAsset \n(\n    User: string\n    , NumberOfLaptop: int\n) \n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, we will put some demo data into the table."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:".ingest inline into table UserAsset <|\nMax,2\nKome,1\n"})}),"\n",(0,s.jsx)(n.p,{children:"We will have the table and its data like below."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UserAsset\n| project\n    User\n    , NumberOfLaptop\n    , IngestedOn = ingestion_time()\n| order by NumberOfLaptop desc\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Kusto table and data",src:t(68017).A+"",width:"588",height:"336"})}),"\n",(0,s.jsx)(n.h3,{id:"get-data-from-azure-data-explorer-adx-to-power-bi-pbi",children:"Get data from Azure Data Explorer (ADX) to Power BI (PBI)"}),"\n",(0,s.jsx)(n.p,{children:"Simple enough, we then can use the very Kusto query (KQ) in PBI Desktop to get such data."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Add new datasource in PBID",src:t(3147).A+"",width:"941",height:"746"})}),"\n",(0,s.jsx)(n.p,{children:"We can copy the query here."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Add query to datasource",src:t(31856).A+"",width:"700",height:"557"})}),"\n",(0,s.jsx)(n.p,{children:"Upon clicking OK and transform the data, we will have the data available. Notice that whole KQ will be put as plain text in the source."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Alt text",src:t(38105).A+"",width:"1659",height:"378"})}),"\n",(0,s.jsx)(n.h3,{id:"using-kusto-function-to-simplify-the-process",children:"Using Kusto function to simplify the process"}),"\n",(0,s.jsx)(n.p,{children:"Now, we can create a function to get data from ADX to PBI Desktop."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:".create function GetDataForPBI() {\n    UserAsset\n    | project\n        User\n        , NumberOfLaptop\n        , IngestedOn = ingestion_time()\n    | order by NumberOfLaptop desc\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Create function",src:t(88710).A+"",width:"1411",height:"341"})}),"\n",(0,s.jsx)(n.p,{children:"Then, we can simply call the function from PBI to get the data instead of calling the whole query."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Getting data using function",src:t(27727).A+"",width:"1487",height:"203"})}),"\n",(0,s.jsx)(n.h3,{id:"enhacing-data-by-altering-the-function",children:"Enhacing data by altering the function"}),"\n",(0,s.jsx)(n.p,{children:"We can even passing parameters to the functions to alter the data. In this case, let's try adding some texts to User. My function would become as below:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Taking a boolean input ",(0,s.jsx)(n.code,{children:"_addText"}),", it is defaulted to ",(0,s.jsx)(n.code,{children:"false"})]}),"\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.code,{children:"_addText"})," is true, add some text to ",(0,s.jsx)(n.code,{children:"User"})]}),"\n",(0,s.jsxs)(n.li,{children:["Else, leave ",(0,s.jsx)(n.code,{children:"User"})," as it is"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Notice that we will need to use ",(0,s.jsx)(n.code,{children:"create-or-alter"})," because the function is existing already."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'.create-or-alter function GetDataForPBI(_addText:bool = false) {\nUserAsset\n| extend\n    User = iff(\n        _addText\n        , strcat(\n            User\n            , "-AddedText"\n        )\n        , User\n    )\n| project\n    User\n    , NumberOfLaptop\n    , IngestedOn = ingestion_time()\n| order by NumberOfLaptop desc\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then, we can call the function from PBI and add the parameter to see how the data is reflected."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Function with parameters",src:t(53236).A+"",width:"1303",height:"219"})}),"\n",(0,s.jsx)(n.p,{children:"We can even add new columns from ADX and the new data will be reflected on PBI. For example, I will add a column (with emoji) to indicate someone is owning more than one laptop."}),"\n",(0,s.jsx)(n.p,{children:"My function will become as below."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'.create-or-alter function GetDataForPBI(_addText:bool = false) {\n    UserAsset\n    | extend\n        User = iff(\n            _addText\n            , strcat(\n                User\n                , "-AddedText"\n            )\n            , User\n        )\n    | project\n        User\n        , NumberOfLaptop\n        , IngestedOn = ingestion_time()\n        , OwningMoreThanOneLaptop = iff(\n            NumberOfLaptop > 1\n            , "\ud83d\udcbb+"\n            , ""\n        )\n    | order by NumberOfLaptop desc\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Upon refreshing the source, we can see the new column coming up."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"New column from Kusto",src:t(69917).A+"",width:"1306",height:"230"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},3147:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-1-c29f624585460bf259a436820d09ff91.png"},31856:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-2-7bf59f241f0d2ca88b42cd62a7141ce4.png"},38105:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-3-7f798d5e223bffda62d5253d65eacbc9.png"},88710:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-4-d7cf06d1a8cd6aba90fff8002d58e30c.png"},27727:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-5-b0b03146315759c18e1c6e5d0ac0fa96.png"},53236:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-6-95bc3715135de749a43a20ea10c94af7.png"},69917:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-7-1bb6ec8dcfa51fae453aa3ae76fa7f3f.png"},68017:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image-cddcf7e80e46384a2e6d7435472c16e0.png"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(96540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);